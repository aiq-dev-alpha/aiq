<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Products</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="toggleView()">
        <ion-icon [name]="isGridView ? 'list' : 'grid'"></ion-icon>
      </ion-button>
      <ion-button (click)="navigateToCart()">
        <ion-icon name="cart"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Search Bar -->
  <ion-searchbar
    [(ngModel)]="searchText"
    (ionInput)="onSearchChange($event)"
    placeholder="Search products..."
    debounce="300">
  </ion-searchbar>

  <!-- Filter Bar -->
  <div class="filter-section">
    <!-- Category Chips -->
    <ion-segment
      [(ngModel)]="selectedCategory"
      (ionChange)="onCategoryChange($event.detail.value)"
      scrollable="true"
      class="category-segment">
      <ion-segment-button *ngFor="let category of categories" [value]="category">
        <ion-label>{{category}}</ion-label>
      </ion-segment-button>
    </ion-segment>

    <!-- Sort Dropdown -->
    <div class="sort-section">
      <ion-select
        [(ngModel)]="selectedSort"
        (ionChange)="onSortChange($event)"
        placeholder="Sort by"
        interface="popover">
        <ion-select-option *ngFor="let option of sortOptions" [value]="option.value">
          {{option.label}}
        </ion-select-option>
      </ion-select>
    </div>
  </div>

  <!-- Results Count -->
  <div class="results-info">
    <p>Found {{filteredProducts.length}} results</p>
  </div>

  <!-- Products Grid View -->
  <div *ngIf="isGridView" class="grid-container">
    <ion-grid>
      <ion-row>
        <ion-col
          size="6"
          *ngFor="let product of filteredProducts"
          (click)="navigateToDetail(product.id)">
          <ion-card class="product-card">
            <!-- Product Image -->
            <div class="product-image">
              <ion-icon name="image" class="placeholder-icon"></ion-icon>
              <div *ngIf="product.originalPrice" class="sale-badge">
                {{calculateDiscount(product.price, product.originalPrice)}}% OFF
              </div>
            </div>

            <ion-card-content>
              <ion-card-title class="product-name">{{product.name}}</ion-card-title>

              <!-- Rating -->
              <div class="rating">
                <div class="stars">
                  <ion-icon
                    *ngFor="let filled of getStars(product.rating)"
                    [name]="filled ? 'star' : 'star-outline'"
                    [color]="filled ? 'warning' : 'medium'">
                  </ion-icon>
                </div>
                <span class="rating-text">{{product.rating}} ({{product.reviews}})</span>
              </div>

              <!-- Price -->
              <div class="price-section">
                <div class="price-row">
                  <span class="current-price">${{product.price}}</span>
                  <span *ngIf="product.originalPrice" class="original-price">${{product.originalPrice}}</span>
                </div>
                <ion-button
                  size="small"
                  fill="solid"
                  (click)="addToCart(product, $event)"
                  class="add-btn">
                  <ion-icon name="add"></ion-icon>
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <!-- Products List View -->
  <div *ngIf="!isGridView" class="list-container">
    <ion-card
      *ngFor="let product of filteredProducts"
      class="product-list-item"
      (click)="navigateToDetail(product.id)">
      <ion-card-content>
        <div class="list-item-content">
          <!-- Product Image -->
          <div class="product-image-small">
            <ion-icon name="image" class="placeholder-icon"></ion-icon>
            <div *ngIf="product.originalPrice" class="sale-badge-small">
              SALE
            </div>
          </div>

          <!-- Product Details -->
          <div class="product-details">
            <h3 class="product-name">{{product.name}}</h3>

            <!-- Rating -->
            <div class="rating">
              <div class="stars">
                <ion-icon
                  *ngFor="let filled of getStars(product.rating)"
                  [name]="filled ? 'star' : 'star-outline'"
                  [color]="filled ? 'warning' : 'medium'"
                  size="small">
                </ion-icon>
              </div>
              <span class="rating-text">{{product.rating}} ({{product.reviews}})</span>
            </div>

            <!-- Price -->
            <div class="price-section">
              <span class="current-price">${{product.price}}</span>
              <span *ngIf="product.originalPrice" class="original-price">${{product.originalPrice}}</span>
            </div>
          </div>

          <!-- Add to Cart -->
          <ion-button
            fill="outline"
            size="default"
            (click)="addToCart(product, $event)"
            class="cart-btn">
            <ion-icon name="cart" slot="icon-only"></ion-icon>
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Empty State -->
  <div *ngIf="filteredProducts.length === 0" class="empty-state">
    <ion-icon name="search" class="empty-icon"></ion-icon>
    <h3>No products found</h3>
    <p>Try adjusting your search or filters</p>
  </div>
</ion-content>