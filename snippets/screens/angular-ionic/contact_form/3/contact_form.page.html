<ion-header>
  <ion-toolbar>
    <ion-title>Contact Us</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="dismiss()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="contactForm" (ngSubmit)="onSubmit()">

    <!-- Contact Information Card -->
    <ion-card>
      <ion-card-header>
        <ion-card-title color="primary">
          <ion-icon name="person-circle-outline"></ion-icon>
          Contact Information
        </ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <ion-grid>
          <ion-row>
            <ion-col size="12">
              <ion-item
                lines="full"
                [class.ion-invalid]="isFieldInvalid('name')"
                [class.ion-valid]="isFieldValid('name')">
                <ion-label position="stacked">Full Name *</ion-label>
                <ion-input
                  formControlName="name"
                  type="text"
                  placeholder="Enter your full name"
                  clearInput="true">
                  <ion-icon name="person" slot="start"></ion-icon>
                </ion-input>
                <ion-note slot="error" *ngIf="isFieldInvalid('name')">
                  {{ getErrorMessage('name') }}
                </ion-note>
              </ion-item>
            </ion-col>
          </ion-row>

          <ion-row>
            <ion-col size="12" size-md="6">
              <ion-item
                lines="full"
                [class.ion-invalid]="isFieldInvalid('email')"
                [class.ion-valid]="isFieldValid('email')">
                <ion-label position="stacked">Email Address *</ion-label>
                <ion-input
                  formControlName="email"
                  type="email"
                  placeholder="Enter your email"
                  clearInput="true">
                  <ion-icon name="mail" slot="start"></ion-icon>
                </ion-input>
                <ion-note slot="error" *ngIf="isFieldInvalid('email')">
                  {{ getErrorMessage('email') }}
                </ion-note>
              </ion-item>
            </ion-col>

            <ion-col size="12" size-md="6">
              <ion-item
                lines="full"
                [class.ion-invalid]="isFieldInvalid('phone')"
                [class.ion-valid]="isFieldValid('phone')">
                <ion-label position="stacked">Phone Number</ion-label>
                <ion-input
                  formControlName="phone"
                  type="tel"
                  placeholder="Optional"
                  clearInput="true">
                  <ion-icon name="call" slot="start"></ion-icon>
                </ion-input>
                <ion-note slot="error" *ngIf="isFieldInvalid('phone')">
                  {{ getErrorMessage('phone') }}
                </ion-note>
              </ion-item>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card-content>
    </ion-card>

    <!-- Message Details Card -->
    <ion-card>
      <ion-card-header>
        <ion-card-title color="primary">
          <ion-icon name="chatbubble-ellipses-outline"></ion-icon>
          Message Details
        </ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <ion-grid>
          <ion-row>
            <ion-col size="12" size-md="6">
              <ion-item lines="full">
                <ion-label position="stacked">Priority *</ion-label>
                <ion-select
                  formControlName="priority"
                  interface="popover"
                  placeholder="Select priority">
                  <ion-icon name="flag" slot="start"></ion-icon>
                  <ion-select-option
                    *ngFor="let priority of priorities"
                    [value]="priority.value">
                    {{ priority.label }}
                  </ion-select-option>
                </ion-select>
              </ion-item>
            </ion-col>

            <ion-col size="12" size-md="6">
              <ion-item
                lines="full"
                [class.ion-invalid]="isFieldInvalid('subject')"
                [class.ion-valid]="isFieldValid('subject')">
                <ion-label position="stacked">Subject *</ion-label>
                <ion-input
                  formControlName="subject"
                  type="text"
                  placeholder="Brief subject line"
                  clearInput="true">
                  <ion-icon name="text" slot="start"></ion-icon>
                </ion-input>
                <ion-note slot="error" *ngIf="isFieldInvalid('subject')">
                  {{ getErrorMessage('subject') }}
                </ion-note>
              </ion-item>
            </ion-col>
          </ion-row>

          <ion-row>
            <ion-col size="12">
              <ion-item
                lines="full"
                [class.ion-invalid]="isFieldInvalid('message')"
                [class.ion-valid]="isFieldValid('message')">
                <ion-label position="stacked">Message *</ion-label>
                <ion-textarea
                  formControlName="message"
                  placeholder="Please describe your inquiry in detail..."
                  rows="6"
                  maxlength="1000">
                  <ion-icon name="document-text" slot="start"></ion-icon>
                </ion-textarea>
                <ion-note slot="helper">{{ getMessageCharacterCount() }}</ion-note>
                <ion-note slot="error" *ngIf="isFieldInvalid('message')">
                  {{ getErrorMessage('message') }}
                </ion-note>
              </ion-item>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card-content>
    </ion-card>

    <!-- Priority Display -->
    <ion-card *ngIf="formControls['priority'].value">
      <ion-card-content>
        <ion-chip [color]="getPriorityColor(formControls['priority'].value)">
          <ion-icon name="flag"></ion-icon>
          <ion-label>
            Priority: {{ priorities.find(p => p.value === formControls['priority'].value)?.label }}
          </ion-label>
        </ion-chip>
      </ion-card-content>
    </ion-card>

    <!-- Action Buttons -->
    <ion-grid>
      <ion-row>
        <ion-col size="12" size-md="6">
          <ion-button
            expand="block"
            fill="outline"
            color="medium"
            (click)="clearForm()"
            [disabled]="isSubmitting">
            <ion-icon name="refresh-outline" slot="start"></ion-icon>
            Clear Form
          </ion-button>
        </ion-col>

        <ion-col size="12" size-md="6">
          <ion-button
            expand="block"
            type="submit"
            [disabled]="isSubmitting || contactForm.invalid">
            <ion-spinner *ngIf="isSubmitting" name="crescent" slot="start"></ion-spinner>
            <ion-icon *ngIf="!isSubmitting" name="send" slot="start"></ion-icon>
            {{ isSubmitting ? 'Sending...' : 'Send Message' }}
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- Form Status Debug (only in development) -->
    <ion-card *ngIf="false">
      <ion-card-header>
        <ion-card-title>Form Status (Debug)</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p>Form Valid: {{ contactForm.valid }}</p>
        <p>Form Touched: {{ contactForm.touched }}</p>
        <p>Form Dirty: {{ contactForm.dirty }}</p>
        <pre>{{ contactForm.value | json }}</pre>
      </ion-card-content>
    </ion-card>

  </form>
</ion-content>